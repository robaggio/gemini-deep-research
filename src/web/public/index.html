<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HIKE Deep Research</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <i></i>
          <h1>HIKE Deep Research</h1>
        </div>
        <div class="header-actions">
          <span class="model-badge">
            <i class="fas fa-brain"></i>
            gemini-deep-research-pro
          </span>
          <button class="mobile-history-btn" id="mobileHistoryBtn" title="历史记录">
            <i class="fas fa-history"></i>
          </button>
          <button class="about-btn" id="aboutBtn" title="关于"><i class="fas fa-info-circle"></i></button>
        </div>
      </div>
    </header>

    <!-- Main Layout -->
    <main class="main-content">
      <!-- Left Panel - Research Form -->
      <div class="research-panel">
        <!-- Tabs Bar -->
        <div class="tabs-bar">
          <div class="tabs-container" id="tabsContainer">
            <button class="tab active" data-tab="new">
              <i class="fas fa-plus"></i> <span>新建研究</span>
            </button>
          </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content-area">
          <div class="tab-panel active" id="newResearchPanel">
            <!-- Query Input -->
            <div class="form-row">
              <label><i class="fas fa-search"></i> 研究问题</label>
              <textarea id="queryInput" placeholder="请输入您的研究问题，研究时间5分钟起，请耐心等待。如果研究失败，可尝试使用英文提问。" rows="5"></textarea>
            </div>

            <!-- Compact Options Row with Upload -->
            <div class="options-row">
              <div class="option-group">
                <label><i class="fas fa-layer-group"></i> 研究深度</label>
                <select id="depthSelect">
                  <option value="quick">快速</option>
                  <option value="standard">标准</option>
                  <option value="deep" selected>深度</option>
                  <option value="maximum">最大</option>
                </select>
              </div>
              <div class="option-group">
                <label><i class="fas fa-globe"></i> 信息来源</label>
                <select id="sourcesSelect">
                  <option value="all" selected>全部</option>
                  <option value="web">网络</option>
                  <option value="academic">学术</option>
                  <option value="news">新闻</option>
                </select>
              </div>
              <div class="option-group upload-group">
                <div class="upload-header">
                  <label><i class="fas fa-cloud-upload-alt"></i> 文件</label>
                  <div class="file-types-info">
                    <i class="fas fa-info-circle" title="支持的文件类型"></i>
                    <div class="file-types-tooltip">
                      <h4>支持的文件类型</h4>
                      <ul>
                        <li><strong>文本文件:</strong> .txt, .md, .csv</li>
                        <li><strong>网页文件:</strong> .html, .htm</li>
                        <li><strong>结构化数据:</strong> .json, .xml, .yaml</li>
                        <li><strong>代码文件:</strong> .py, .js, .ts, .java, .c, .cpp, .h, .hpp</li>
                      </ul>
                      <small>最大文件大小: 50MB，最多20个文件</small>
                    </div>
                  </div>
                </div>
                <div class="inline-upload" id="dropZone">
                  <button type="button" class="browse-btn" id="browseBtn"><i class="fas fa-file"></i> 选择文件</button>
                  <button type="button" class="browse-btn folder-btn" id="browseFolderBtn"><i class="fas fa-folder"></i> 选择文件夹</button>
                </div>
                <input type="file" id="fileInput" multiple hidden
                       accept=".txt,.md,.csv,.html,.htm,.json,.xml,.py,.js,.ts,.java,.c,.cpp,.h,.hpp,.yaml,text/plain,text/markdown,text/csv,text/html,application/json,application/xml,application/javascript,text/javascript,text/x-python,text/x-java-source,text/x-c,text/x-c++">
                <input type="file" id="folderInput" webkitdirectory directory multiple hidden>
              </div>
            </div>

            <!-- File Queue (only shows when files are selected) -->
            <div class="file-queue" id="fileQueue"></div>

            <!-- Action Buttons -->
            <div class="action-row">
              <button class="research-btn" id="startResearchBtn">
                <i class="fas fa-rocket"></i> 开始研究
              </button>
              <button class="stop-research-btn hidden" id="stopResearchBtn" title="停止研究">
                <i class="fas fa-stop"></i> 停止
              </button>
            </div>

            <!-- Progress (hidden by default) -->
            <div class="progress-section hidden" id="progressSection">
              <div class="progress-info">
                <span><strong>状态:</strong> <span id="progressStatus">初始化中...</span></span>
                <span><strong>时间:</strong> <span id="elapsedTime">0.0秒</span></span>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
              </div>
            </div>
          </div>

          <!-- Result Panels Container -->
          <div id="resultPanelsContainer"></div>
        </div>
      </div>

      <!-- Right Panel - History -->
      <aside class="history-panel" id="historyPanel">
        <div class="history-header">
          <h3><i class="fas fa-history"></i> 历史记录</h3>
          <button class="clear-btn" id="clearHistoryBtn" title="清空"><i class="fas fa-trash"></i></button>
        </div>
        <div class="history-list" id="resultsList"></div>
      </aside>
    </main>

    <!-- Toast -->
    <div class="toast-container" id="toastContainer"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // Append timestamp to script src to prevent caching
    const script = document.createElement('script');
    script.src = 'app.js?v=' + new Date().getTime();
    document.body.appendChild(script);
  </script>
</body>
</html>
